<!-- app/views/pages/create_book.html.erb -->
<div class="max-w-xl mx-auto mt-10 p-6 bg-white shadow-lg rounded-lg">
  <h1 class="text-2xl font-bold text-gray-800 mb-6">Create Book (via API)</h1>

  <form id="book-form" class="space-y-4">
    <div>
      <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
      <input type="text" name="title" id="title" required
             class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
    </div>

    <div>
      <label for="author" class="block text-sm font-medium text-gray-700">Author</label>
      <input type="text" name="author" id="author" required
             class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
    </div>

    <div>
      <label for="genre" class="block text-sm font-medium text-gray-700">Genre</label>
      <input type="text" name="genre" id="genre"
             class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
    </div>

    <div>
      <label for="isbn" class="block text-sm font-medium text-gray-700">ISBN</label>
      <input type="text" name="isbn" id="isbn" required
             class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
    </div>

    <div>
      <label for="total_copies" class="block text-sm font-medium text-gray-700">Total Copies</label>
      <input type="number" name="total_copies" id="total_copies" required
             class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-blue-500 focus:border-blue-500">
    </div>

    <div>
      <button type="submit"
              class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
        Submit
      </button>
    </div>
  </form>

  <div id="response" class="mt-4 text-sm text-center text-gray-700 font-medium"></div>
</div>

<script>
document.getElementById("book-form").addEventListener("submit", async function (e) {
  e.preventDefault();

  const formData = new FormData(e.target);
  const bookData = {
    book: {
      title: formData.get("title"),
      author: formData.get("author"),
      genre: formData.get("genre"),
      isbn: formData.get("isbn"),
      total_copies: parseInt(formData.get("total_copies"))
    }
  };

  try {
    const response = await fetch("/api/v1/books", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json",
        "X-CSRF-Token": document.querySelector("[name=csrf-token]").content
      },
      body: JSON.stringify(bookData)
    });

    const result = await response.json();
    document.getElementById("response").innerText = response.ok
      ? "✅ Book created successfully!"
      : `❌ Error: ${result.errors.join(", ")}`;
  } catch (err) {
    document.getElementById("response").innerText = "❌ Network error!";
  }
});
</script>
